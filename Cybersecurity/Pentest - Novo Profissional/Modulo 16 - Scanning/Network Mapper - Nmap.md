
---

O **Nmap (Network Mapper)** é a ferramenta padrão para descoberta de hosts, mapeamento de portas e identificação de serviços/versões/OS em redes. É extremamente valiosa para equipes ofensivas porque entrega um retrato rápido (e configurável) do perímetro e do interior de uma rede — base para reconhecimento, seleção de alvos, planejamento de exploração e validação pós-exploração.

Usos principais para equipe ofensiva / pentest / red team:

- **Mapear superfície de ataque**: quais hosts estão vivos e quais portas/serviços expõem.

- **Identificar versões e possíveis vetores**: descobrir versões de serviço que podem ter vulnerabilidades conhecidas.

- **Descoberta de SO e fingerprinting**: ajuda a determinar o tipo de sistema alvo.

- **Automação com NSE (Nmap Scripting Engine)**: checar misconfigurações, coleta de dados, brute force, identificação de vulnerabilidades conhecidas (com cuidado e autorização).

- **Suporte a pivoting e pós-exploração**: descobrir serviços internos após ganhar acesso a uma rede.

- **Evidência e relatório**: gerar resultados em vários formatos para entrega ao cliente.

## Tipos de scan importantes (com o que servem)

- **Host discovery / Ping scan**: `-sn` — descobrir hosts vivos (sem scan de portas).

- **SYN scan (half-open)**: `-sS` — rápido e frequentemente menos ruidoso que full connect; usado muito em pentests.

- **TCP connect**: `-sT` — usa a pilha do SO; útil quando não se tem privilégios para raw sockets.

- **UDP scan**: `-sU` — escanear serviços UDP (mais lento e propenso a falsos negativos).

- **Version detection**: `-sV` — tenta identificar versão do serviço.

- **OS detection**: `-O` — fingerprint do sistema operacional.

- **Aggressive/All-in-one**: `-A` — combina detecção de versão, OS, scripts e traceroute (ruidoso).

- **Port spec / range**: `-p` — ex.: `-p 22,80,443` ou `-p 1-65535`.

- **Timing templates**: `-T0`..`-T5` — segurança/stealth vs velocidade (`T3` padrão, `T4/T5` rápido e barulhento).

- **NSE (scripts)**: `--script` — rodar scripts (categories: discovery, auth, vuln, brute, intrusive).

##  Formatos de saída úteis

- `-oN output.txt` — normal (legível)

- `-oX output.xml` — XML (integração)

- `-oG output.gnmap` — grepable

- `-oA basename` — gera os três acima (`.nmap`, `.xml`, `.gnmap`)

1. Descoberta rápida de hosts na rede:

```bash
nmap -sn 10.10.10.0/24
```
Explica: descobre quem responde (ICMP / ARP / TCP ping dependendo de permissões).

2. Scan TCP SYN em portas comuns com detecção de versão:

```bash
nmap -sS -p 22,80,135,139,445,3389 -sV 10.10.10.25
```
Explica: faz SYN scan nas portas listadas e tenta identificar versões de serviços.

3. Scan completo (todas as portas TCP) e output para análise:


```bash
nmap -sS -p- -sV -O -oA target_full 10.10.10.25
```
Explica: `-p-` varre 1-65535; `-O` tenta OS fingerprint; `-oA` salva em 3 formatos.

4. Varredura UDP básica (mais lenta — combine com timing baixo):

```bash
nmap -sU -p 53,67,123,161 --top-ports 100 10.10.10.0/24
```
Explica: examina serviços UDP comuns (DNS, DHCP, NTP, SNMP).

5. Uso de scripts NSE (ex.: descoberta e checagem de vulnerabilidades leves):

```bash
nmap -sV --script "default,safe" 10.10.10.25
```
Explica: roda scripts classificados como `default` e `safe` — bom primeiro passo.

6. Scan mais furtivo (Red Team — reduzir ruído; **não garanta invisibilidade**):

```bash
nmap -sS -T2 -p 22,80,443 --scan-delay 200ms --max-retries 2 10.10.10.0/24
```
Explica: `-T2` mais lento/stealth; `--scan-delay` espaça pacotes; `--max-retries` reduz tentativas repetidas.

7. Usando decoys / spoofing (aumenta o ruído e complexidade de detecção; pode ser detectado facilmente):

```bash
nmap -sS -D RND:5 -p 80,443 10.10.10.25
```
Explica: `-D RND:5` insere 5 IPs aleatórios como decoys. **Use apenas em engagements autorizados**.

8. Rodando script específico e passando argumentos:

```bash
nmap --script smb-brute --script-args userdb=users.txt,passdb=passes.txt -p 445 10.10.10.25
```
Explica: run a brute-force script (intrusive) — só em testes autorizados.

9. Integração com proxychains / socks (quando roteando por um jump host):

```bash
proxychains4 nmap -sT -p 80,443 --traceroute 10.10.10.25
```
Explica: usar `proxychains` para rotear tráfego; recomenda-se `-sT` porque raw sockets podem não funcionar via proxy.