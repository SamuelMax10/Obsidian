
---

### **Funcionamento Geral**

- O programa percorre todas as portas possíveis de 0 a 65535.
- Para cada porta, ele tenta estabelecer uma conexão TCP com o IP de destino fornecido pelo usuário como argumento na linha de comando.
- Se a conexão for bem-sucedida, a porta é considerada **"ABERTA"**, e o programa exibe essa informação.
- O programa fecha o _socket_ após cada tentativa, independentemente do sucesso ou falha da conexão.

---

### **Componentes do Código**

1. **Inclusão de Bibliotecas**
    - `#include <stdio.h>`: Usada para funções de entrada e saída, como `printf` e `perror`.
    - `#include <sys/socket.h>`: Contém definições e funções para a criação e manipulação de _sockets_.
    - `#include <netdb.h>`: Inclui estruturas para operações de rede, como `sockaddr_in`.
    - `#include <arpa/inet.h>`: Contém funções para manipular endereços IP, como `inet_addr`.
    - `#include <unistd.h>`: Inclui a função `close`, usada para fechar descritores de arquivo (_sockets_).

---

2. **Validação de Argumentos**
   
    `char *destino;
    ``destino = argv[1];``
    
    - O IP de destino é obtido a partir do argumento da linha de comando (`argv[1]`).

---

3. **Laço de Varredura**
   
    `for (porta = inicio; porta <= final; porta++) {`
    
    - **`porta`**: Itera de 0 até 65535 (todas as portas TCP possíveis).
    - Para cada porta, o código tenta criar um socket e conectar-se ao destino.

---

4. **Criação do Socket**
    
    `meusocket = socket(AF_INET, SOCK_STREAM, 0);
    ``if (meusocket < 0) {     
	    ``printf("Erro ao criar o socket");``
	    ``continue; }``
    
    - `socket(AF_INET, SOCK_STREAM, 0)` cria um socket:
        - `AF_INET`: Indica o uso de IPv4.
        - `SOCK_STREAM`: Define o socket como orientado à conexão (TCP).
        - `0`: Usa o protocolo padrão para TCP.
    - Se a criação do socket falhar (`meusocket < 0`), o programa exibe uma mensagem de erro com ``printf`` e pula para a próxima porta.

---

5. **Configuração do Endereço do Alvo**

    `alvo.sin_family = AF_INET; 
    ``alvo.sin_port = htons(porta); 
    ``alvo.sin_addr.s_addr = inet_addr(destino);``
    
    - **`alvo.sin_family`**: Define a família do endereço como IPv4 (`AF_INET`).
    - **`alvo.sin_port`**: Define a porta a ser usada, convertida para ordem de bytes de rede com `htons`.
    - **`alvo.sin_addr.s_addr`**: Define o endereço IP, convertido do formato de string para um formato numérico com `inet_addr(destino)`.

---

6. **Tentativa de Conexão**

    `conecta = connect(meusocket, (struct sockaddr *)&alvo, sizeof(alvo));`
    
    - **`connect`**: Tenta estabelecer uma conexão TCP com o IP e a porta especificados.
    - Retorna `0` em caso de sucesso ou um valor negativo em caso de falha.

---

7. **Verificação do Resultado**

    `if (conecta == 0) {     printf("Porta %d - status [ABERTO] \n", porta);     fflush(stdout); }`
    
    - Se a conexão for bem-sucedida (`conecta == 0`), exibe uma mensagem indicando que a porta está aberta.
    - O uso de `fflush(stdout)` garante que a mensagem seja exibida imediatamente no console, evitando atrasos causados pelo _buffering_ da saída.

---

8. **Fechamento do Socket**

    
    `close(meusocket);`
    
    - Após cada tentativa de conexão, o _socket_ é fechado para liberar os recursos do sistema.

---

9. **Finalização do Programa**

    
    `return 0;`
    
    - Indica que o programa terminou com sucesso.

#### **Versão Final**

```
#include <stdio.h>
#include <stdlib.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <unistd.h>`
```
````
int main(int argc, char *argv[]) {
    if (argc < 2) {
        printf("Uso: %s <IP>\n", argv[0]);
        return 1;
    }

    int meusocket;
    int conecta;
    int porta;
    int inicio = 0;
    int final = 65535;
    char *destino = argv[1];

    struct sockaddr_in alvo;

    printf("Escaneando portas de %s...\n", destino);
    fflush(stdout); // Garante que esta mensagem seja exibida imediatamente
````
```
  for (porta = inicio; porta <= final; porta++) {
        // Criação do socket
        meusocket = socket(AF_INET, SOCK_STREAM, 0);
        if (meusocket < 0) {
            perror("Erro ao criar o socket");
            continue; // Tenta a próxima porta
        }`
```
 ```     
        // Configuração do alvo
        alvo.sin_family = AF_INET;
        alvo.sin_port = htons(porta); // Define a porta atual
        alvo.sin_addr.s_addr = inet_addr(destino);

        // Tentativa de conexão
        conecta = connect(meusocket, (struct sockaddr *)&alvo, sizeof(alvo));

        if (conecta == 0) {
            printf("Porta %d - status [ABERTA]\n", porta);
            fflush(stdout); // Força a exibição da mensagem
        }

        // Fechamento do socket
        close(meusocket);
    }

    printf("Varredura concluída.\n");
    fflush(stdout); // Garante exibição antes do término do programa

    return 0;
}
```
