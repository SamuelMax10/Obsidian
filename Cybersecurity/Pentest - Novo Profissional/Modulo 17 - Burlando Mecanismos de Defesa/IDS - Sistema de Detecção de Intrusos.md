
---

Um Sistema de Detecção de Intrusão (IDS) é uma ferramenta de segurança cibernética que monitora o tráfego de rede e atividades de sistemas para identificar ameaças, atividades suspeitas ou violações de políticas de segurança. Ao detectar uma intrusão, o IDS gera alertas para notificar as equipes de TI e segurança, permitindo que investiguem e tomem medidas para mitigar os riscos, embora o IDS em si não bloqueie o tráfego automaticamente.

### Como funciona um IDS:

- **Monitoramento passivo:** 
    O IDS atua como um sistema de escuta, analisando cópias do tráfego de rede e atividades do sistema sem interferir diretamente no fluxo de dados. 

- **Análise de padrões:** 
    Ele analisa os dados para detectar padrões de ataque conhecidos, comportamentos anômalos ou desvios de uma linha de base de tráfego normal. 

- **Geração de alertas:** 
    Se uma atividade suspeita for identificada, o IDS gera um alerta, enviando-o para um sistema de gerenciamento de eventos de segurança (SIEM) ou para as equipes de segurança.

### Snort

O **Snort** é um **IDS (Intrusion Detection System)** e também pode funcionar como **IPS (Intrusion Prevention System)** dependendo da forma como é configurado. Ele é um dos mais populares no mundo, gratuito e open source, criado pela **Sourcefire** (hoje Cisco).

O que é e como funciona

- O **Snort** monitora o tráfego de rede em tempo real.

- Ele analisa pacotes que passam pela interface de rede e compara com **regras pré-definidas** (signatures).

- Essas regras descrevem padrões de ataques conhecidos, como varredura de portas, tentativas de exploração, malware, tráfego suspeito etc.

- Quando encontra algo que bate com uma regra, pode:
    - **Apenas alertar** (modo IDS).
    - **Bloquear/descartar pacotes** (modo IPS).


Principais modos de operação

1. **Sniffer Mode** → apenas captura pacotes e exibe no terminal, como um tcpdump.
2. **Packet Logger Mode** → grava o tráfego em arquivos para análise posterior.
3. **Network Intrusion Detection System (NIDS) Mode** → compara pacotes com as regras e gera alertas.
4. **Inline Mode (IPS)** → além de detectar, bloqueia pacotes em tempo real.

Estrutura básica do Snort

O Snort funciona em **pipeline**:

1. **Captura de pacotes** (libpcap, igual tcpdump).
2. **Pré-processadores** (normalizam, detectam anomalias, reorganizam pacotes fragmentados).
3. **Engine de detecção** (aplica as regras).
4. **Mecanismo de saída** (logs, alertas, syslog, integração com SIEM, etc).

Regras do Snort

As **regras** são a parte mais importante.  
Uma regra tem a forma:

```
alert tcp any any -> 192.168.1.10 80 (msg:"Acesso HTTP detectado"; sid:1000001;)
```

- `alert` → ação (pode ser alert, log, drop, reject).
- `tcp` → protocolo.
- `any any` → origem (IP/porta).
- `-> 192.168.1.10 80` → destino (IP/porta).
- `(msg:"..."; sid:1000001;)` → opções: mensagem, ID da regra, etc.

### Exemplo pratico utilizando o Snort

Foi criado um diretório rules em /etc/rules, este diretório contem a rule icmp-info.rules, irei utilizar essa regra no meu treinamento.

```bash
snort -c /etc/snort/snort.lua -A fast --tweaks snort.debian -i eth0 --rule-path=/etc/rules -q
```

O comando acima ira executa o Snort como um sistema de detecção de intrusão, monitorando a interface de rede `eth0` de forma silenciosa, usando um arquivo de configuração Lua e aplicando ajustes específicos do Debian, além de um modo de alerta rápido e um caminho personalizado para as regras. Para poder testar irei realizar o ping da maquina do atacante e ira trazer o seguinte retorno:

Maquina que esta rodando a regra:
![](https://i.imgur.com/IwhfnTN.png)

Ping realizado pelo atacante:
![](https://i.imgur.com/L4N792M.png)

OBS:

**-c** - Especifica o arquivo de configuração e regras para o Snort.

**-A fast** - Um modo de alerta mais simples e conciso. Ele mostra o carimbo de data/hora, a mensagem de alerta, os endereços IP de origem e destino, e as portas associadas. É útil para análise rápida.

**--tweaks snort.debian** - Aplica um conjunto de ajustes de política específico para a instalação do Snort em distribuições baseadas em Debian

**-i** - Especifica a interface de rede na qual o Snort irá monitorar o tráfego. Se esta opção for omitida, o Snort tentará detectar a interface principal da máquina.

**--rule-path=** - A opção `--rule-path=` (ou `-R` em algumas versões) é utilizada para especificar o caminho para os arquivos de regras.

**-q** - Significa **modo silencioso** ou _quiet mode_. Quando essa flag é utilizada, o Snort suprime a exibição do banner inicial e das estatísticas de processamento na tela, que são mostradas por padrão ao iniciar a ferramenta.

